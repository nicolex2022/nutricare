<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NutriCare Assistant | Science & Kindness</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root { --sage: #4a7c59; --light-mint: #f0f7f4; --protein-blue: #3a86ff; }
        body { background-color: var(--light-mint); font-family: 'Segoe UI', sans-serif; color: #2d4033; }
        .hero { background: var(--sage); color: white; padding: 40px 0; border-radius: 0 0 40px 40px; }
        .card { border: none; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        .warm-box { background: #fffde7; border-left: 5px solid #ffd600; padding: 15px; border-radius: 12px; font-style: italic; }
        .stat-val { font-size: 2.5rem; font-weight: 800; color: var(--sage); }
        .btn-main { background: var(--sage); color: white; border-radius: 12px; font-weight: bold; border: none; padding: 12px; transition: 0.3s; }
        .btn-main:hover { background: #355e42; color: white; transform: translateY(-2px); }
        .form-control { border-radius: 10px; border: 1px solid #dee2e6; }
        .badge-bmi { background: #6c757d; color: white; padding: 5px 12px; border-radius: 50px; }
        .protein-text { color: var(--protein-blue); font-weight: bold; }
    </style>
</head>
<body>

<div class="hero text-center shadow mb-5">
    <h1 class="fw-bold">NutriCare Assistant</h1>
    <p>Scientific Tracking with a Warm Heart ‚ù§Ô∏è</p>
</div>

<div class="container pb-5">
    {% if error %}<div class="alert alert-danger rounded-3">{{ error }}</div>{% endif %}

    <form method="POST">
    <div class="row g-4">
        <!-- 1. Health Profile ‰∏™‰∫∫ËµÑÊñôÊ†è -->
        <div class="col-lg-4">
            <div class="card p-4 h-100">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h5 class="fw-bold mb-0">1. Health Profile</h5>
                    {% if profile.weight %}<a href="/reset" class="btn btn-sm btn-outline-danger">Reset</a>{% endif %}
                </div>
                
                {% if not profile.weight %}
                <div class="row g-3">
                    <div class="col-12"><label class="small text-muted">Age</label><input type="number" name="age" class="form-control" required></div>
                    <div class="col-6"><label class="small text-muted">Weight (kg)</label><input type="number" step="0.1" name="weight" class="form-control" required></div>
                    <div class="col-6"><label class="small text-muted">Height (cm)</label><input type="number" name="height" class="form-control" required></div>
                    <div class="col-6"><label class="small text-muted">Gender</label><select name="gender" class="form-select"><option value="female">Female</option><option value="male">Male</option></select></div>
                    <div class="col-6"><label class="small text-muted">Goal</label><select name="goal" class="form-select">
                        <option value="gain">Muscle Gain üí™</option>
                        <option value="lose">Weight Loss üìâ</option>
                        <option value="maintain">Maintain ‚öñÔ∏è</option>
                    </select></div>
                </div>
                {% else %}
                <div class="p-3 bg-light rounded-3 mb-3">
                    <p class="mb-1"><strong>Weight:</strong> {{ profile.weight }}kg | <strong>Goal:</strong> {{ profile.goal }}</p>
                    <p class="mb-0 small text-success">Profile saved! Log your meals below.</p>
                </div>
                <div class="text-center opacity-50 mt-4">
                    <img src="https://cdn-icons-png.flaticon.com/512/3062/3062013.png" width="80">
                </div>
                {% endif %}
            </div>
        </div>

        <!-- 2. Daily Meal Log È•ÆÈ£üËÆ∞ÂΩïÊ†è -->
        <div class="col-lg-4">
            <div class="card p-4 h-100">
                <h5 class="fw-bold mb-4">2. Daily Meal Log</h5>
                <div class="mb-3"><label class="fw-bold small text-success">Breakfast</label><textarea name="breakfast_input" class="form-control border-0 bg-light" rows="2" placeholder="e.g. oats:50, milk:200"></textarea></div>
                <div class="mb-3"><label class="fw-bold small text-success">Lunch</label><textarea name="lunch_input" class="form-control border-0 bg-light" rows="2" placeholder="rice:150, chicken breast:150"></textarea></div>
                <div class="mb-3"><label class="fw-bold small text-success">Dinner</label><textarea name="dinner_input" class="form-control border-0 bg-light" rows="2" placeholder="tofu:100, broccoli:200"></textarea></div>
                <div class="mb-4"><label class="fw-bold small text-success">Snacks</label><textarea name="snacks_input" class="form-control border-0 bg-light" rows="2" placeholder="apple:150"></textarea></div>
                <button type="submit" class="btn-main w-100 shadow">Generate Daily Report</button>
            </div>
        </div>

        <!-- 3. Dashboard Êï∞ÊçÆÈù¢Êùø -->
        <div class="col-lg-4">
            {% if analysis %}
            <div class="card p-4">
                <div class="warm-box mb-4">"{{ analysis.warm }}"</div>
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="fw-bold text-success mb-0">Dashboard</h5>
                    <span class="badge-bmi small">BMI: {{ analysis.bmi }}</span>
                </div>
                
                <div class="text-center my-4">
                    <!-- ÁÉ≠ÈáèÈÉ®ÂàÜ -->
                    <div class="stat-val">{{ analysis.total_cal }}</div>
                    <p class="text-muted small mb-2">Calories In / Target: {{ analysis.target }}</p>
                    <div class="progress mb-2" style="height: 12px; border-radius: 10px;">
                        <div class="progress-bar" style="width: {{ analysis.percent }}%; background: var(--sage)"></div>
                    </div>
                    <div class="small fw-bold mb-4">{{ analysis.percent }}% of Calorie Goal</div>

                    <!-- ËõãÁôΩË¥®ËøΩË∏™ÈÉ®ÂàÜÔºà‰∏ìÈó®‰∏∫Â¢ûËÇåËÆæËÆ°Ôºâ -->
                    <div class="mt-2 p-3 bg-light rounded-3">
                        <div class="d-flex justify-content-between small px-1">
                            <span class="fw-bold protein-text">Protein Intake</span>
                            <span class="text-muted">{{ analysis.pro }}g / {{ analysis.target_pro }}g</span>
                        </div>
                        <div class="progress mt-2" style="height: 10px; border-radius: 10px;">
                            <!-- ËÆ°ÁÆóËõãÁôΩË¥®ÁôæÂàÜÊØî -->
                            {% set pro_percent = (analysis.pro / analysis.target_pro * 100)|int if analysis.target_pro > 0 else 0 %}
                            <div class="progress-bar" style="width: {{ pro_percent }}%; background: var(--protein-blue)"></div>
                        </div>
                        <small class="text-muted mt-1 d-block">{{ pro_percent }}% of Daily Protein Target</small>
                    </div>
                </div>

                <!-- ÂæÆÈáèÂÖÉÁ¥†ËØ¶ÊÉÖ -->
                <div class="alert alert-light border small">
                    <div class="d-flex justify-content-around text-center">
                        <div><strong>P</strong><br>{{ analysis.pro }}g</div>
                        <div><strong>F</strong><br>{{ analysis.fat }}g</div>
                        <div><strong>C</strong><br>{{ analysis.carb }}g</div>
                    </div>
                    <hr class="my-2">
                    <div class="d-flex justify-content-around text-center text-muted">
                        <div>Fiber: {{ analysis.fiber }}g</div>
                        <div>Sugar: {{ analysis.sugar }}g</div>
                    </div>
                </div>

                <div class="text-center mt-3">
                    <span class="text-muted small text-uppercase fw-bold">Health Score</span>
                    <div class="h3 fw-bold text-success">{{ analysis.score }}/100</div>
                </div>
            </div>
            {% else %}
            <div class="card h-100 d-flex flex-column justify-content-center align-items-center opacity-50 p-5 text-center bg-white">
                <img src="https://cdn-icons-png.flaticon.com/512/1693/1693746.png" width="60" class="mb-3">
                <h5>Input your meals to see the scientific magic.</h5>
                <p class="small text-muted mt-2">Special tracking enabled for Muscle Gain goals!</p>
            </div>
            {% endif %}
        </div>
    </div>
    </form>
</div>

</body>
</html>
