<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NutriCare Assistant | Science & Kindness</title>
    <!-- ÂºïÂÖ• Bootstrap Ê°ÜÊû∂ÔºåË¥üË¥£Â∏ÉÂ±Ä -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root { --sage: #4a7c59; --light-mint: #f0f7f4; --protein-blue: #0077b6; }
        body { background-color: var(--light-mint); font-family: 'Segoe UI', system-ui, sans-serif; color: #2d4033; }
        
        /* È°∂ÈÉ®ÁªøËâ≤ËÉåÊôØ */
        .hero { background: var(--sage); color: white; padding: 40px 0; border-radius: 0 0 40px 40px; }
        
        /* Âç°ÁâáÊ†∑Âºè */
        .card { border: none; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); background: white; }
        
        /* ÊöñÂøÉËØ≠ÂΩïÊ°Ü */
        .warm-box { background: #fffde7; border-left: 5px solid #ffd600; padding: 15px; border-radius: 12px; font-style: italic; color: #555; }
        
        /* Â§ßÊï∞Â≠óÊ†∑Âºè */
        .stat-val { font-size: 2.5rem; font-weight: 800; color: var(--sage); line-height: 1; }
        
        /* ÊåâÈíÆ */
        .btn-main { background: var(--sage); color: white; border-radius: 12px; font-weight: bold; border: none; padding: 12px; width: 100%; transition: 0.3s; }
        .btn-main:hover { background: #355e42; color: white; transform: translateY(-2px); }
        
        /* ËæìÂÖ•Ê°Ü */
        .form-control, .form-select { border-radius: 10px; border: 1px solid #eee; background-color: #f8f9fa; }
        .form-control:focus { box-shadow: none; border-color: var(--sage); }

        /* ËøõÂ∫¶Êù°ÂÆöÂà∂ */
        .progress { background-color: #e9ecef; border-radius: 10px; overflow: hidden; }
    </style>
</head>
<body>

<!-- È°∂ÈÉ®Ê†áÈ¢òÂå∫ -->
<div class="hero text-center shadow mb-5">
    <h1 class="fw-bold">NutriCare Assistant</h1>
    <p class="opacity-75">Scientific Tracking with a Warm Heart ‚ù§Ô∏è</p>
</div>

<div class="container pb-5">
    <!-- ÈîôËØØÊèêÁ§∫ -->
    {% if error %}
    <div class="alert alert-danger rounded-3 border-0 shadow-sm">{{ error }}</div>
    {% endif %}

    <form method="POST">
    <div class="row g-4">
        
        <!-- 1. Health Profile ‰∏™‰∫∫ËµÑÊñôÊ†è -->
        <div class="col-lg-4">
            <div class="card p-4 h-100">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h5 class="fw-bold mb-0">1. Health Profile</h5>
                    {% if profile.weight %}
                    <a href="/reset" class="btn btn-sm btn-outline-danger" style="border-radius: 8px;">Reset</a>
                    {% endif %}
                </div>
                
                {% if not profile.weight %}
                <!-- Êú™Â°´ÂÜôÁä∂ÊÄÅÔºöÊòæÁ§∫ËæìÂÖ•Ë°®Âçï -->
                <div class="row g-3">
                    <div class="col-12"><label class="small text-muted fw-bold">Age</label><input type="number" name="age" class="form-control" placeholder="e.g. 25" required></div>
                    <div class="col-6"><label class="small text-muted fw-bold">Weight (kg)</label><input type="number" step="0.1" name="weight" class="form-control" placeholder="60.5" required></div>
                    <div class="col-6"><label class="small text-muted fw-bold">Height (cm)</label><input type="number" name="height" class="form-control" placeholder="170" required></div>
                    <div class="col-6"><label class="small text-muted fw-bold">Gender</label><select name="gender" class="form-select"><option value="female">Female</option><option value="male">Male</option></select></div>
                    <div class="col-6"><label class="small text-muted fw-bold">Goal</label><select name="goal" class="form-select">
                        <option value="gain">Muscle Gain üí™</option>
                        <option value="lose">Weight Loss üìâ</option>
                        <option value="maintain">Maintain ‚öñÔ∏è</option>
                    </select></div>
                    <div class="col-12 mt-4"><p class="small text-muted italic">Setting your profile helps us calculate scientific targets for you.</p></div>
                </div>
                {% else %}
                <!-- Â∑≤Â°´ÂÜôÁä∂ÊÄÅÔºöÊòæÁ§∫ËµÑÊñôÊëòË¶Å -->
                <div class="p-3 bg-light rounded-3 mb-3 border-start border-4 border-success">
                    <p class="mb-1"><strong>Weight:</strong> {{ profile.weight }}kg</p>
                    <p class="mb-0"><strong>Goal:</strong> {{ profile.goal }}</p>
                </div>
                <p class="small text-success fw-bold">‚úÖ Profile saved! Now, tell me what you ate today.</p>
                <div class="text-center mt-4 opacity-25">
                    <img src="https://cdn-icons-png.flaticon.com/512/3062/3062013.png" width="80" alt="profile icon">
                </div>
                {% endif %}
            </div>
        </div>

        <!-- 2. Daily Meal Log È•ÆÈ£üËÆ∞ÂΩïÊ†è -->
        <div class="col-lg-4">
            <div class="card p-4 h-100">
                <h5 class="fw-bold mb-4">2. Daily Meal Log</h5>
                <div class="mb-3">
                    <label class="fw-bold small text-success">Breakfast</label>
                    <textarea name="breakfast_input" class="form-control border-0" rows="2" placeholder="e.g. oats:50, milk:200"></textarea>
                </div>
                <div class="mb-3">
                    <label class="fw-bold small text-success">Lunch</label>
                    <textarea name="lunch_input" class="form-control border-0" rows="2" placeholder="rice:150, chicken breast:150"></textarea>
                </div>
                <div class="mb-3">
                    <label class="fw-bold small text-success">Dinner</label>
                    <textarea name="dinner_input" class="form-control border-0" rows="2" placeholder="tofu:100, broccoli:200"></textarea>
                </div>
                <div class="mb-4">
                    <label class="fw-bold small text-success">Snacks</label>
                    <textarea name="snacks_input" class="form-control border-0" rows="2" placeholder="apple:150"></textarea>
                </div>
                <button type="submit" class="btn-main shadow">Generate Daily Report</button>
            </div>
        </div>

        <!-- 3. Dashboard Êï∞ÊçÆÈù¢ÊùøÂå∫ -->
        <div class="col-lg-4">
            {% if analysis %}
            <div class="card p-4">
                <!-- ÊöñÂøÉÂ∞èË¥¥Â£´ -->
                <div class="warm-box mb-4">"{{ analysis.warm }}"</div>
                
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="fw-bold text-success mb-0">Dashboard</h5>
                    <span class="badge bg-secondary rounded-pill small">BMI: {{ analysis.bmi }}</span>
                </div>
                
                <!-- ÁÉ≠ÈáèËøõÂ∫¶ -->
                <div class="text-center my-4">
                    <div class="stat-val mb-1">{{ analysis.total_cal }}</div>
                    <p class="text-muted small">Calories In / Target: {{ analysis.target }}</p>
                    <div class="progress mb-2" style="height: 12px;">
                        <div class="progress-bar" style="width: {{ analysis.percent }}%; background: var(--sage)"></div>
                    </div>
                    <span class="small fw-bold">{{ analysis.percent }}% of Calorie Goal</span>

                    <!-- ËõãÁôΩË¥®ËøõÂ∫¶ (ÈíàÂØπÂ¢ûËÇå‰ºòÂåñ) -->
                    <div class="mt-4 p-3 bg-light rounded-3 text-start">
                        <div class="d-flex justify-content-between mb-1">
                            <span class="small fw-bold" style="color: var(--protein-blue)">Protein Track</span>
                            <span class="small text-muted">{{ analysis.pro }}g / {{ analysis.target_pro }}g</span>
                        </div>
                        <div class="progress" style="height: 8px;">
                            {% set pro_percent = (analysis.pro / analysis.target_pro * 100)|int if analysis.target_pro > 0 else 0 %}
                            <div class="progress-bar" style="width: {{ pro_percent }}%; background: var(--protein-blue)"></div>
                        </div>
                        <small class="text-muted mt-1 d-block" style="font-size: 0.7rem;">{{ pro_percent }}% of protein target achieved</small>
                    </div>
                </div>

                <!-- ËØ¶ÁªÜËê•ÂÖªÁ¥†ÂàóË°® -->
                <div class="alert alert-light border-0 bg-light small mb-3">
                    <div class="row text-center g-0">
                        <div class="col-4 border-end"><strong>P</strong><br>{{ analysis.pro }}g</div>
                        <div class="col-4 border-end"><strong>F</strong><br>{{ analysis.fat }}g</div>
                        <div class="col-4"><strong>C</strong><br>{{ analysis.carb }}g</div>
                    </div>
                    <hr class="my-2 opacity-10">
                    <div class="row text-center text-muted g-0">
                        <div class="col-6">Fiber: {{ analysis.fiber }}g</div>
                        <div class="col-6">Sugar: {{ analysis.sugar }}g</div>
                    </div>
                </div>

                <!-- ÂÅ•Â∫∑ËØÑÂàÜ -->
                <div class="text-center">
                    <span class="text-muted small text-uppercase fw-bold" style="letter-spacing: 1px;">Health Score</span>
                    <div class="h3 fw-bold text-success mb-0">{{ analysis.score }}/100</div>
                </div>
            </div>
            {% else %}
            <!-- ÈªòËÆ§Êú™ÂàÜÊûêÁä∂ÊÄÅ -->
            <div class="card h-100 d-flex flex-column justify-content-center align-items-center opacity-50 p-5 text-center">
                <img src="https://cdn-icons-png.flaticon.com/512/1693/1693746.png" width="60" class="mb-3">
                <h5 class="fw-bold">Waiting for your log...</h5>
                <p class="small">Input your meals to see your scientific daily report and progress.</p>
                <p class="small text-success fw-bold mt-2">Special tracking enabled for Muscle Gain! üí™</p>
            </div>
            {% endif %}
        </div>
    </div>
    </form>
</div>

</body>
</html>
